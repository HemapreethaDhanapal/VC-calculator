<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Step Cost Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        .hidden { display: none; }
        .step { display: none; }
        .step.active { display: block; }
        .button-group { margin-top: 20px; text-align: center; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
        #prevBtn { background: #ccc; }
        #nextBtn, #submitBtn { background: #007bff; color: white; }
        label { display: block; margin: 10px 0; }
        input[type="text"], input[type="email"] { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
        .steps-navigation { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .steps-navigation div { padding: 10px; cursor: pointer; background: #ddd; border-radius: 5px; }
        .steps-navigation div.active { background: #007bff; color: white; }
        .steps-navigation div.disabled { background: #ccc; pointer-events: none; opacity: 0.5; }
        .error-msg { color: red; display: block; margin-top: 5px; opacity: 0; transition: opacity 0.3s ease-in-out; }
        .input-textarea{width:auto;}
        
   </style>
</head>
<body>
    <div class="container">
        <h2>Cost Calculator</h2>
        <div class="steps-navigation" id="stepsNav"></div>
        <form id="calculatorForm"></form>
        <div class="button-group">
            <button type="button" id="prevBtn" onclick="changeStep(-1)" class="hidden">Back</button>
            <button type="button" id="nextBtn" onclick="changeStep(1)">Next</button>
            <button type="submit" id="submitBtn" class="hidden">Finish</button>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            try {
                const response = await fetch("http://localhost:3000/0");
                const formData = await response.json();
                populateForm(formData);
            } catch (error) {
                console.error("Error fetching JSON data:", error);
            }
        });

        function populateForm(formData) {
    const formContainer = document.getElementById("calculatorForm");
    let stepIndex = 1;

    Object.keys(formData).forEach((key) => {
        const stepData = formData[key];
        const stepDiv = document.createElement("div");
        stepDiv.classList.add("step", stepData["dom-class"]); 
        if (stepIndex === 1) stepDiv.classList.add("active");
        stepDiv.id = `step${stepIndex}`; 
        stepData.questions.forEach((question, qIndex) => {
            const questionContainer = document.createElement("div");
            const questionTitle = document.createElement("h4");
            questionTitle.textContent = question.title;
            questionContainer.appendChild(questionTitle);

            const optionsContainer = document.createElement("div");
            optionsContainer.classList.add("dom-class-column"); 

            question.options.forEach(option => {
                const label = document.createElement("label");
                const inputName = `${key}_question${qIndex}`;

                if (option.include === "textarea" && (!option.type || !option.name)) {
                    label.innerHTML = `
                        <textarea class="input-textarea" name="${inputName}_other" placeholder="Please specify..."></textarea>
                    `;
                } else if (option.type === "checkbox" && option.include === "textarea") {
                    label.innerHTML = `
                        <input type="checkbox" name="${inputName}" value="Other"> Other 
                        <textarea class="input-textarea" name="${inputName}_other" placeholder="Please specify..." disabled></textarea>
                    `;
                } else if (option.type === "radio" && option.include === "textarea") { 
                    label.innerHTML = `
                        <input type="radio" name="${inputName}" value="Other"> Other 
                        <textarea class="input-textarea" name="${inputName}_other" placeholder="Please specify..." disabled></textarea>
                    `;
                } else if (option.type === "checkbox") {
                    label.innerHTML = `
                        <input type="checkbox" name="${inputName}" value="${option.name}"> ${option.name}
                    `;
                } else if (option.type === "inputtext") {
                    label.innerHTML = `
                        <input type="text" name="${inputName}_input" placeholder="Enter your response...">
                    `;
                } else {
                    label.innerHTML = `
                        <input type="radio" name="${inputName}" value="${option.name}"> ${option.name}
                    `;
                }

                optionsContainer.appendChild(label);
            });

            questionContainer.appendChild(optionsContainer);
            stepDiv.appendChild(questionContainer);
        });

        const errorMsg = document.createElement("span");
        errorMsg.classList.add("error-msg");
        errorMsg.id = `error${stepIndex}`;
        errorMsg.textContent = "Please fill in the required fields.";
        stepDiv.appendChild(errorMsg);

        formContainer.appendChild(stepDiv);
        stepIndex++;
    });

    document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
        input.addEventListener("change", function() {
            const parentLabel = this.closest("label");
            const textarea = parentLabel ? parentLabel.querySelector("textarea") : null;

            if (textarea) {
                textarea.disabled = !this.checked;
                if (this.checked) textarea.focus();
            }
        });
    });

    updateNavigation();
}

        let currentStep = 1;
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const stepsNav = document.getElementById('stepsNav');

        function updateNavigation() {
            stepsNav.innerHTML = '';
            const steps = document.querySelectorAll('.step');

            steps.forEach((_, index) => {
                const stepNav = document.createElement('div');
                stepNav.innerText = `Step ${index + 1}`;
                stepNav.classList.toggle('active', index + 1 === currentStep);

                if (index + 1 < currentStep) {
                    stepNav.classList.add('clickable');
                    stepNav.addEventListener("click", () => goToStep(index + 1));
                } else {
                    stepNav.classList.remove('clickable');
                }

                stepsNav.appendChild(stepNav);
            });
        }
        function goToStep(step) {
            const steps = document.querySelectorAll('.step');
            steps[currentStep - 1].classList.remove('active');
            currentStep = step;
            steps[currentStep - 1].classList.add('active');
            updateNavigation();

            prevBtn.classList.toggle('hidden', currentStep === 1);
            nextBtn.classList.toggle('hidden', currentStep === steps.length);
            submitBtn.classList.toggle('hidden', currentStep !== steps.length);
        }

        function validateStep(step) {
            const stepElement = document.getElementById(`step${step}`);
            const stepInputs = stepElement.querySelectorAll('input');
            let isValid = false;
            
            stepInputs.forEach(input => {
                if ((input.type === "radio" || input.type === "checkbox") && input.checked) {
                    isValid = true;
                } else if (input.type === "text" && input.value.trim()) {
                    isValid = true;
                }

                input.addEventListener("input", () => {
                    document.getElementById(`error${step}`).style.opacity = "0";
                });

                if (input.type === "radio" || input.type === "checkbox") {
                    input.addEventListener("change", () => {
                        document.getElementById(`error${step}`).style.opacity = "0";
                    });
                }
            });

            return isValid;
        }

        function changeStep(direction) {
            const steps = document.querySelectorAll('.step');
            const errorMsg = document.getElementById(`error${currentStep}`);
            if (direction === 1 && !validateStep(currentStep)) {
                errorMsg.style.opacity = "1";
                return;
            }
            errorMsg.style.opacity = "0";

            steps[currentStep - 1].classList.remove('active');
            currentStep += direction;
            steps[currentStep - 1].classList.add('active');
            updateNavigation();

            prevBtn.classList.toggle('hidden', currentStep === 1);
            nextBtn.classList.toggle('hidden', currentStep === steps.length);
            submitBtn.classList.toggle('hidden', currentStep !== steps.length);
        }
    </script>
</body>
</html>
